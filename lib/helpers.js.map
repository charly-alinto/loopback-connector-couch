{"version":3,"sources":["helpers.js"],"names":[],"mappings":";;;;;;eAAU,QAAQ,QAAR;;IAAL;;;;AAGL,OAAO,OAAP;WAAuB;;;;;;qCACG,UAAU;AAChC,eAAS,QAAT,GAAoB,SAAS,QAAT,IAAqB,SAAS,IAAT,IAAiB,WAAtC,CADY;AAEhC,eAAS,QAAT,GAAoB,SAAS,QAAT,IAAqB,MAArB,CAFY;AAGhC,eAAS,IAAT,GAAgB,SAAS,IAAT,IAAiB,IAAjB,CAHgB;AAIhC,eAAS,QAAT,GAAoB,SAAS,QAAT,IAAqB,SAAS,EAAT,CAJT;AAKhC,UAAI,CAAC,SAAS,QAAT,EAAmB;AACtB,cAAM,IAAI,KAAJ,CAAU,qEAAV,CAAN,CADsB;OAAxB;;;;0BAKW,MAAM,QAAQ;AACzB,UAAI,CAAC,IAAD,EAAO;AACT,eAAO,MAAP,CADS;OAAX;AAGA,UAAI,CAAC,EAAE,OAAF,CAAU,IAAV,CAAD,EAAkB;AACpB,UAAE,MAAF,CAAS,IAAT,EAAe,MAAf,EADoB;OAAtB,MAEO;AACL,UAAE,IAAF,CAAO,IAAP,EAAa,UAAS,GAAT,EAAc;AACzB,iBAAO,EAAE,MAAF,CAAS,GAAT,EAAc,MAAd,CAAP,CADyB;SAAd,CAAb,CADK;OAFP;AAOA,aAAO,IAAP,CAXyB;;;;4BAcZ,KAAK;AAClB,UAAI,QAAJ,CADkB;AAElB,UAAI,WAAW,IAAI,KAAJ,CAAU,eAAV,CAAX,EAAuC;AACzC,YAAI,SAAS,CAAT,MAAgB,IAAhB,EAAsB;AACxB,iBAAO,CAAC,CAAD,CADiB;SAA1B;OADF;AAKA,aAAO,CAAP,CAPkB;;;;+BAUF,KAAK;AACrB,aAAO,IAAI,OAAJ,CAAY,cAAZ,EAA4B,EAA5B,CAAP,CADqB;;;;6BAIP,OAAO,MAAM;AAC3B,UAAI,EAAJ,CAD2B;AAE3B,UAAI,KAAK,KAAK,EAAL,EAAS;AAChB,aAAK,GAAL,GAAW,GAAG,QAAH,EAAX,CADgB;OAAlB;AAGA,aAAO,KAAK,EAAL,CALoB;AAM3B,UAAI,KAAK,IAAL,KAAc,IAAd,EAAoB;AACtB,eAAO,KAAK,IAAL,CADe;OAAxB;AAGA,UAAI,KAAJ,EAAW;AACT,aAAK,aAAL,GAAqB,KAArB,CADS;OAAX;AAGA,aAZ2B;;;;6BAeb,MAAM;AACpB,UAAI,GAAJ,CADoB;AAEpB,UAAI,MAAM,KAAK,GAAL,EAAU;AAClB,aAAK,EAAL,GAAU,IAAI,QAAJ,EAAV,CADkB;OAApB;AAGA,aAAO,KAAK,GAAL,CALa;AAMpB,aAAO,KAAK,aAAL,CANa;AAOpB,aAPoB;;;;+BAUJ,WAAW;AAC3B,aAAO,cAAc,SAAd,CADoB;;;;6BAIb,UAAU;AACxB,aAAO,QAAQ,QAAR,CADiB;;;;6CAIM,UAAU,KAAK,KAAK;;AAElD,UAAI,QAAJ,EAAc;AACZ,eAAO,YAAY,SAAS,GAAT,EAAc,GAAd,CAAZ,CADK;OAAd,MAEO,IAAI,GAAJ,EAAS;;AAEd,eAAO,QAAQ,GAAR,CAAY,GAAZ,CAAP,CAFc;OAAT;;;;iCAMW,IAAI,YAAY,QAAQ,UAAU;;AAEpD,aAAO,GAAG,GAAH,CAAO,UAAP,EAAmB,UAAC,GAAD,EAAM,SAAN,EAAoB;AAC5C,YAAI,OAAO,IAAI,KAAJ,KAAc,WAAd,EAA2B;AACpC,iBAAO,QAAQ,wBAAR,CAAiC,QAAjC,EAA2C,GAA3C,EAAgD,SAAhD,CAAP,CADoC;SAAtC;;;AAD4C,YAMxC,CAAC,SAAD,EAAY;AACd,sBAAY,MAAZ,CADc;SAAhB,MAEO;;AAEL,cAAI,EAAE,OAAF,CAAU,UAAU,KAAV,EAAiB,OAAO,KAAP,CAA/B,EAA8C;AAC5C,mBAAO,QAAQ,wBAAR,CAAiC,QAAjC,EAA2C,IAA3C,EAAiD,SAAjD,CAAP,CAD4C;WAA9C;AAGA,oBAAU,KAAV,GAAkB,OAAO,KAAP,CALb;SAFP;;;AAN4C,eAiBrC,GAAG,MAAH,CAAU,SAAV,EAAqB,UAArB,EAAiC,UAAC,GAAD,EAAM,WAAN,EAAsB;AAC5D,iBAAO,QAAQ,wBAAR,CAAiC,QAAjC,EAA2C,GAA3C,EAAgD,WAAhD,CAAP,CAD4D;SAAtB,CAAxC,CAjB4C;OAApB,CAA1B,CAFoD;;;;SAlFjC;GAAvB","file":"helpers.js","sourcesContent":["var {_} = require('lodash');\n\n// Helpers\nmodule.exports = class Helpers {\n  static optimizeSettings(settings) {\n    settings.hostname = settings.hostname || settings.host || '127.0.0.1';\n    settings.protocol = settings.protocol || 'http';\n    settings.port = settings.port || 5984;\n    settings.database = settings.database || settings.db;\n    if (!settings.database) {\n      throw new Error('Database name must be specified in dataSource for CouchDB connector');\n    }\n  }\n\n  static merge(base, update) {\n    if (!base) {\n      return update;\n    }\n    if (!_.isArray(base)) {\n      _.extend(base, update);\n    } else {\n      _.each(base, function(doc) {\n        return _.extend(doc, update);\n      });\n    }\n    return base;\n  }\n\n  static reverse(key) {\n    var hasOrder;\n    if (hasOrder = key.match(/\\s+(A|DE)SC$/i)) {\n      if (hasOrder[1] === 'DE') {\n        return -1;\n      }\n    }\n    return 1;\n  }\n\n  static stripOrder(key) {\n    return key.replace(/\\s+(A|DE)SC/i, '');\n  }\n\n  static savePrep(model, data) {\n    var id;\n    if (id = data.id) {\n      data._id = id.toString();\n    }\n    delete data.id;\n    if (data._rev === null) {\n      delete data._rev;\n    }\n    if (model) {\n      data.loopbackModel = model;\n    }\n    return;\n  }\n\n  static undoPrep(data) {\n    var _id;\n    if (_id = data._id) {\n      data.id = _id.toString();\n    }\n    delete data._id;\n    delete data.loopbackModel;\n    return;\n  }\n\n  static designName(modelName) {\n    return 'loopback_' + modelName;\n  }\n\n  static viewName(propName) {\n    return 'by_' + propName;\n  }\n\n  static invokeCallbackOrLogError(callback, err, res) {\n    // When callback exists let it handle the error and result\n    if (callback) {\n      return callback && callback(err, res);\n    } else if (err) {\n      // Without a callback we can at least log the error\n      return console.log(err);\n    }\n  }\n\n  static updateDesign(db, designName, design, callback) {\n    // Add the design document to the database or update it if it already exists.\n    return db.get(designName, (err, designDoc) => {\n      if (err && err.error !== 'not_found') {\n        return Helpers.invokeCallbackOrLogError(callback, err, designDoc);\n      }\n\n      // Update the design doc\n      if (!designDoc) {\n        designDoc = design;\n      } else {\n        // We only update the design when its views have changed - this avoids rebuilding the views.\n        if (_.isEqual(designDoc.views, design.views)) {\n          return Helpers.invokeCallbackOrLogError(callback, null, designDoc);\n        }\n        designDoc.views = design.views;\n      }\n\n      // Insert the design doc into the database.\n      return db.insert(designDoc, designName, (err, insertedDoc) => {\n        return Helpers.invokeCallbackOrLogError(callback, err, insertedDoc);\n      });\n    });\n  }\n};\n"],"sourceRoot":"/source/"}
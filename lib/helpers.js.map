{"version":3,"sources":["helpers.js"],"names":[],"mappings":"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","file":"helpers.js","sourcesContent":["var {_} = require('lodash');\n\n// Helpers\nmodule.exports = class Helpers {\n  static optimizeSettings(settings) {\n    settings.hostname = settings.hostname || settings.host || '127.0.0.1';\n    settings.protocol = settings.protocol || 'http';\n    settings.port = settings.port || 5984;\n    settings.database = settings.database || settings.db;\n    if (!settings.database) {\n      throw new Error('Database name must be specified in dataSource for CouchDB connector');\n    }\n  }\n\n  static merge(base, update) {\n    if (!base) {\n      return update;\n    }\n    if (!_.isArray(base)) {\n      _.extend(base, update);\n    } else {\n      _.each(base, function(doc) {\n        return _.extend(doc, update);\n      });\n    }\n    return base;\n  }\n\n  static reverse(key) {\n    var hasOrder;\n    if (hasOrder = key.match(/\\s+(A|DE)SC$/i)) {\n      if (hasOrder[1] === 'DE') {\n        return -1;\n      }\n    }\n    return 1;\n  }\n\n  static stripOrder(key) {\n    return key.replace(/\\s+(A|DE)SC/i, '');\n  }\n\n  static savePrep(model, data) {\n    var id;\n    if (id = data.id) {\n      data._id = id.toString();\n    }\n    delete data.id;\n    if (data._rev === null) {\n      delete data._rev;\n    }\n    if (model) {\n      data.loopbackModel = model;\n    }\n    return;\n  }\n\n  static undoPrep(data) {\n    var _id;\n    if (_id = data._id) {\n      data.id = _id.toString();\n    }\n    delete data._id;\n    delete data.loopbackModel;\n    return;\n  }\n\n  static designName(modelName) {\n    return 'loopback_' + modelName;\n  }\n\n  static viewName(propName) {\n    return 'by_' + propName;\n  }\n\n  static invokeCallbackOrLogError(callback, err, res) {\n    // When callback exists let it handle the error and result\n    if (callback) {\n      return callback && callback(err, res);\n    } else if (err) {\n      // Without a callback we can at least log the error\n      return console.log(err);\n    }\n  }\n\n  static updateDesign(db, designName, design, callback) {\n    // Add the design document to the database or update it if it already exists.\n    return db.get(designName, (err, designDoc) => {\n      if (err && err.error !== 'not_found') {\n        return Helpers.invokeCallbackOrLogError(callback, err, designDoc);\n      }\n\n      // Update the design doc\n      if (!designDoc) {\n        designDoc = design;\n      } else {\n        // We only update the design when its views have changed - this avoids rebuilding the views.\n        if (_.isEqual(designDoc.views, design.views)) {\n          return Helpers.invokeCallbackOrLogError(callback, null, designDoc);\n        }\n        designDoc.views = design.views;\n      }\n\n      // Insert the design doc into the database.\n      return db.insert(designDoc, designName, (err, insertedDoc) => {\n        return Helpers.invokeCallbackOrLogError(callback, err, insertedDoc);\n      });\n    });\n  }\n};\n"],"sourceRoot":"/source/"}